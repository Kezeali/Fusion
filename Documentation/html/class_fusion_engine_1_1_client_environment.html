<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Fusion: FusionEngine::ClientEnvironment Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6-NO -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespace_fusion_engine.html">FusionEngine</a>::<a class="el" href="class_fusion_engine_1_1_client_environment.html">ClientEnvironment</a></div>
<h1>FusionEngine::ClientEnvironment Class Reference</h1><!-- doxytag: class="FusionEngine::ClientEnvironment" -->The client gameplay environment.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;FusionClientEnvironment.h&gt;</code>
<p>
Collaboration diagram for FusionEngine::ClientEnvironment:<p><center><img src="class_fusion_engine_1_1_client_environment__coll__graph.png" border="0" usemap="#_fusion_engine_1_1_client_environment__coll__map" alt="Collaboration graph"></center>
<map name="_fusion_engine_1_1_client_environment__coll__map">
<area href="class_fusion_engine_1_1_client_options.html" shape="rect" coords="28,9,220,36" alt="">
<area href="class_fusion_engine_1_1_fusion_scene.html" shape="rect" coords="30,60,219,87" alt="">
<area href="class_fusion_engine_1_1_fusion_physics_world.html" shape="rect" coords="8,111,240,137" alt="">
<area href="class_fusion_engine_1_1_fusion_network_client.html" shape="rect" coords="7,161,242,188" alt="">
<area href="class_fusion_engine_1_1_fusion_input.html" shape="rect" coords="34,212,215,239" alt="">
</map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center><a href="class_fusion_engine_1_1_client_environment-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7affdfb440c17573c80cea56d511a286"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ShipList" ref="7affdfb440c17573c80cea56d511a286" args="" -->
typedef std::vector&lt; <a class="el" href="class_fusion_engine_1_1_fusion_client_ship.html">FusionClientShip</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#7affdfb440c17573c80cea56d511a286">ShipList</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of ships. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c52c30c1da0073c4090ce665d33f2fb4"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ProjectileList" ref="c52c30c1da0073c4090ce665d33f2fb4" args="" -->
typedef std::vector&lt; <a class="el" href="class_fusion_engine_1_1_fusion_projectile.html">FusionProjectile</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#c52c30c1da0073c4090ce665d33f2fb4">ProjectileList</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of projectiles. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7100a0c25c23e735be794d0cef841f3a"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ShipResourceMap" ref="7100a0c25c23e735be794d0cef841f3a" args="" -->
typedef std::map&lt; std::string,<br>
 <a class="el" href="class_fusion_engine_1_1_ship_resource.html">ShipResource</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#7100a0c25c23e735be794d0cef841f3a">ShipResourceMap</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of resources. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="6a8f5e962c5c68bd430b3670269e48a4"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ShipInputList" ref="6a8f5e962c5c68bd430b3670269e48a4" args="" -->
typedef std::vector&lt; <a class="el" href="struct_fusion_engine_1_1_ship_input.html">ShipInput</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#6a8f5e962c5c68bd430b3670269e48a4">ShipInputList</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of inputs. <br></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c90cf4a3c787ec082b398c35504cd1ef"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ClientEnvironment" ref="c90cf4a3c787ec082b398c35504cd1ef" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#c90cf4a3c787ec082b398c35504cd1ef">ClientEnvironment</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3b680e7181828ed1f96a1d1040e0584a"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::ClientEnvironment" ref="3b680e7181828ed1f96a1d1040e0584a" args="(const std::string &amp;hostname, const std::string &amp;port, ClientOptions *options)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#3b680e7181828ed1f96a1d1040e0584a">ClientEnvironment</a> (const std::string &amp;hostname, const std::string &amp;port, <a class="el" href="class_fusion_engine_1_1_client_options.html">ClientOptions</a> *options)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bea3556857e1db7d2f8280049f02def5"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::~ClientEnvironment" ref="bea3556857e1db7d2f8280049f02def5" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#bea3556857e1db7d2f8280049f02def5">~ClientEnvironment</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructor. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9c56fe319b09004ccab38beca01ed9ac"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::Initialise" ref="9c56fe319b09004ccab38beca01ed9ac" args="(ResourceLoader *resources)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#9c56fe319b09004ccab38beca01ed9ac">Initialise</a> (<a class="el" href="class_fusion_engine_1_1_resource_loader.html">ResourceLoader</a> *resources)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pulls the resources from the <a class="el" href="class_fusion_engine_1_1_resource_loader.html">ResourceLoader</a>. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#65a19c773d309b8de83b1448dd28e095">Update</a> (unsigned int split)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Does everything.  <a href="#65a19c773d309b8de83b1448dd28e095"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2bf0282838c804fbdecd1512f290c057"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::Draw" ref="2bf0282838c804fbdecd1512f290c057" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#2bf0282838c804fbdecd1512f290c057">Draw</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Draws stuff. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7ecc9c588d76db0ed3992bb512b93fd9"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::GetShipResourceByID" ref="7ecc9c588d76db0ed3992bb512b93fd9" args="(std::string id) const " -->
const <a class="el" href="class_fusion_engine_1_1_ship_resource.html">ShipResource</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#7ecc9c588d76db0ed3992bb512b93fd9">GetShipResourceByID</a> (std::string id) const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called by <a class="el" href="class_fusion_engine_1_1_fusion_ship_drawable.html#96a2ad97b6bba86127d1d2010f2c9519">FusionShipDrawable::Draw()</a> to get the sprite, etc. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a48aa19e6f5cd93a72211d7fd0ec854a"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::_quit" ref="a48aa19e6f5cd93a72211d7fd0ec854a" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_fusion_engine_1_1_client_environment.html#a48aa19e6f5cd93a72211d7fd0ec854a">_quit</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Leaves the client environment cleanly. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The client gameplay environment. 
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd><a class="el" href="class_fusion_engine_1_1_client_environment.html">ClientEnvironment</a> and <a class="el" href="class_fusion_engine_1_1_server_environment.html">ServerEnvironment</a> should probably inherit from a common parent.</dd></dl>
This is where all the gameplay stuff goes on at the client-side. Moving / drawing ships, syncing with server, prediction, etc. is all controlled from here. That isn't to say just this one class does all thoes things, this class just controlls the activities of other, more specific classes which do.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="class_fusion_engine_1_1_fusion_scene.html">FusionScene</a> | <a class="el" href="class_fusion_engine_1_1_fusion_input.html">FusionInput</a> | FusionNetworkingHandler. </dd></dl>

<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="65a19c773d309b8de83b1448dd28e095"></a><!-- doxytag: member="FusionEngine::ClientEnvironment::Update" ref="65a19c773d309b8de83b1448dd28e095" args="(unsigned int split)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool ClientEnvironment::Update           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>split</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Does everything. 
<p>
Actually, this function just does the following:<ol type=1>
<li>Queries <a class="el" href="class_fusion_engine_1_1_fusion_input.html">FusionInput</a> for input data</li><li>Queries FusionNetwork for new messages.</li><li>Updates the state of all objects based on any frames received. It does this by finding the time of the received frame in the history, then interpolating between the closest stored frames to that time, to check if the local movements match up with the remote ones. If they don't, the gameplay is run through again from that point (without drawing of course!), using the new frame and any input from subsiquent keyframes (where the input changed) in that time period, to place the object at the correct position.</li><li>Updates the positions of all objects based on their current state / inputs. This provides pridictive movement if no new frames were received.</li><li>Using their current state and inputs in the prevoius steps, it builds a new frame for each local ship.</li><li>Decides whether enough time has passed to allow an update, and adds the current frame of each ship to the message queue and history if it has.</li><li>Sends everything in the message queue (this may include non-gameplay messages added to the queue by other threads (eg from the console and chat) too, but we don't care about them - I may even give them their own queue and/or socket).</li><li>Sets the positions of the ship nodes by calling UpdateNode on each ship.</li><li>Updates the positions of all non-synced objects (this doesn't include weapons, engines, etc. because those are child nodes and moved with their parents.)</li></ol>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>split</em>&nbsp;</td><td>The amount of time since <a class="el" href="class_fusion_engine_1_1_client_environment.html#65a19c773d309b8de83b1448dd28e095">ClientEnvironment::Update()</a> was lass called. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li>F:/Projects/Fusion/FusionEngine/FusionClientEnvironment.h<li>F:/Projects/Fusion/FusionEngine/FusionClientEnvironment.cpp</ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Oct 9 22:18:56 2006 for Fusion by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO </small></address>
</body>
</html>
